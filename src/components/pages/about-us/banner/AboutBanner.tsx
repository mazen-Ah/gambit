'use client';

import Badge from '@/src/components/common/Badge';
import { useEffect, useRef } from 'react';
import Image from 'next/image';

const COLS = 6;
const ROWS = 4;
const COLOR_A = "#CF0F69";
const COLOR_B = "#B00D59";

const AboutBanner = (props: any) => {
  const data = props.data || props;
  
  const getText = (content: any) => content?.en || content?.ar || '';
  
  const title = getText(data?.content?.subtitle); // Swapped: subtitle -> title
  const subtitle = getText(data?.content?.title); // Swapped: title -> subtitle
  const description = getText(data?.content?.description);
  const iconUrl = data?.media?.find((m: any) => m.collection_name === 'icon')?.url;
  const stageRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const stage = stageRef.current;
    if (!stage) return;

    const init = () => {
      // Clear existing content
      stage.innerHTML = '';
      
      const width = window.innerWidth;
      const isMobile = width < 768;
      const currentCols = isMobile ? 3 : COLS;
      const colWidth = 100 / currentCols;

      // Create columns
      for (let c = 0; c < currentCols; c++) {
        const col = document.createElement("div");
        // responsive width
        col.style.width = `${colWidth}vw`;
        col.className = "h-full overflow-hidden relative z-[1]";
        
        const track = document.createElement("div");
        track.className = "absolute top-0 left-0 flex flex-col";
        track.style.willChange = "transform";

        const buildPattern = () => {
          const frag = document.createDocumentFragment();
          for (let r = 0; r < ROWS; r++) {
            const tile = document.createElement("div");
            tile.style.width = `${colWidth}vw`;
            tile.style.height = `${colWidth}vw`; // Keep aspect ratio square based on width
            tile.className = "flex-shrink-0";
            const useB = (r + c) % 2 === 1;
            tile.style.background = useB ? COLOR_B : COLOR_A;
            frag.appendChild(tile);
          }
          return frag;
        };

        track.appendChild(buildPattern());
        track.appendChild(buildPattern());
        col.appendChild(track);
        stage.appendChild(col);

        const dir = c % 2 === 0 ? "scrollDown" : "scrollUp";
        const speed = 10 + Math.random() * 2;
        track.style.animation = `${dir} ${speed}s linear infinite`;
      }

      const setVH = () => {
        if (stage) {
          stage.style.height = `${window.innerHeight}px`;
        }
      };

      setVH();
    };

    init();
    
    // We want to re-init on resize to handle breakpoint changes
    let resizeTimer: NodeJS.Timeout;
    const handleResize = () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        init();
      }, 200);
    };

    window.addEventListener("resize", handleResize);

    return () => {
      window.removeEventListener("resize", handleResize);
      clearTimeout(resizeTimer);
    };
  }, []);

  return (
    <div className="relative h-[75vh] lg:h-screen w-screen overflow-hidden bg-[#cf0f69] m-0">
      <div
        className="absolute inset-0 z-20 pointer-events-none"
        style={{ background: 'radial-gradient(50% 50% at 50% 50%, rgba(207, 15, 105, 0) 0%, #cf0f69 100%)' }}
      />
      <div 
        ref={stageRef}
        className="relative flex w-screen h-screen bg-black/10"
        style={{ isolation: 'isolate' }}
      >
      </div>
      <div className="absolute w-125.75 lg:w-233.25 flex flex-col items-center top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white z-30">
        <div className='flex flex-col items-center gap-4 text-center'>
        <Badge className='border-white/30'>ABOUT US</Badge>
          <h1 className="hero__heading w-full text-[3.125rem]! lg:text-[6.25rem]! leading-[105%] font-bold ">
            {title}
          </h1>
          
          {description && (
            <p className='hero__paragraph w-115.75 lg:w-155.25 text-[1.125rem] leading-[148%] tracking-[-0.01563rem]! mt-4'>
              {description}
            </p>
          )}
        </div>
        <div className='pt-45 size-31.75 hidden lg:block'>
          <svg className='infinite__rotate' width="127" height="127" viewBox="0 0 127 127" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.13647 62.8315L7.38684 62.0947C8.38821 61.1624 8.90847 60.2301 9.00916 58.8959C9.10986 57.5896 8.4889 56.6908 7.53229 56.6183H7.50432C6.60925 56.5457 6.0722 56.9923 5.47362 58.9796C4.8191 61.1624 4.01913 62.1226 2.43037 61.9998H2.4024C0.897561 61.8825 -0.131773 60.459 0.0136767 58.6224C0.125561 57.2044 0.601069 56.2554 1.46817 55.3231L2.26255 56.0209C1.46258 56.8583 1.07098 57.7292 0.998257 58.7228C0.897562 59.9901 1.51292 60.8274 2.39681 60.8944H2.42478C3.33664 60.967 3.89606 60.526 4.50583 58.427C5.15475 56.3168 6.00507 55.3845 7.48195 55.4962H7.50992C9.1658 55.6246 10.1336 57.0872 9.98815 59.002C9.86508 60.5427 9.27209 61.7485 8.13647 62.8204V62.8315Z" fill="white"/>
            <path d="M5.61433 53.1282H5.58636C2.92911 52.4471 1.23407 49.8959 1.93334 47.1493C2.3641 45.4467 3.22001 44.5647 4.35004 43.8724L4.94303 44.7935C3.98642 45.4076 3.2312 46.1278 2.90673 47.4117C2.38088 49.4884 3.67314 51.4702 5.8381 52.0173H5.86607C8.04222 52.5755 10.14 51.4534 10.6659 49.3768C10.9904 48.0928 10.7107 47.1214 10.0785 46.0049L10.94 45.4802C11.6896 46.6972 12.0645 47.9588 11.6393 49.6503C10.9512 52.3578 8.31074 53.8092 5.61433 53.1282Z" fill="white"/>
            <path d="M4.23096 40.3723L5.97076 36.593C6.47423 35.4988 7.19589 34.7954 8.00145 34.4996C8.64479 34.2595 9.34406 34.293 10.0489 34.6168L10.0769 34.628C11.537 35.2979 11.9398 36.6991 11.5482 38.1896L16.3872 37.1401L15.8278 38.357L11.2349 39.3396L10.0825 41.8517L13.5062 43.4204L13.0474 44.414L4.24215 40.3779L4.23096 40.3723ZM10.4182 38.7367C11.0167 37.4304 10.7762 36.1631 9.64615 35.6495L9.61818 35.6384C8.52172 35.136 7.50357 35.6719 6.84905 37.0898L5.60154 39.8029L9.17624 41.4386L10.4182 38.7367Z" fill="white"/>
            <path d="M17.3606 19.8428L18.1494 19.0836L24.1687 25.3248L28.0959 21.5511L28.7951 22.2768L24.0792 26.8098L17.355 19.8428H17.3606Z" fill="white"/>
            <path d="M24.4922 13.3933L25.3873 12.7625L30.3997 19.8354L34.8527 16.6925L35.4345 17.5131L30.0864 21.2869L24.4922 13.3933Z" fill="white"/>
            <path d="M39.4498 5.91342L36.4234 7.14157L36.043 6.2093L43.1085 3.3399L43.4889 4.27218L40.4624 5.50032L43.7294 13.5223L42.7169 13.9354L39.4498 5.90784V5.91342Z" fill="white"/>
            <path d="M46.2454 7.34248V7.31457C45.6748 4.70755 47.1461 2.00005 50.0327 1.38598C52.9137 0.766326 55.336 2.60854 55.901 5.21556V5.24347C56.4716 7.85048 55.0003 10.5524 52.1137 11.1721C49.2271 11.7917 46.8104 9.94949 46.2454 7.34248ZM54.7989 5.50584V5.47793C54.329 3.32868 52.3822 1.91073 50.2173 2.37966C48.0523 2.84301 46.8831 4.90294 47.3474 7.05219V7.0801C47.8174 9.22935 49.7641 10.6473 51.9291 10.1784C54.0941 9.71503 55.2632 7.6551 54.7989 5.50584Z" fill="white"/>
            <path d="M63.3742 0L66.7308 0.206551C69.7684 0.390773 71.7432 2.60143 71.5754 5.3201V5.34801C71.4075 8.06667 69.1754 10.0484 66.1378 9.85865L62.7812 9.65209L63.3742 0ZM64.4036 1.07183L63.9337 8.71424L66.1993 8.8538C68.644 9.00453 70.3055 7.45818 70.4397 5.30335V5.27544C70.574 3.13735 69.1139 1.36212 66.6692 1.2114L64.4036 1.07183Z" fill="white"/>
            <path d="M75.2052 1.19934L76.2792 1.41147L74.4164 10.9017L73.3423 10.6895L75.2052 1.19934Z" fill="white"/>
            <path d="M76.7646 9.86297L77.6541 9.30472C78.3366 10.4938 79.1254 11.2083 80.4009 11.6159C81.654 12.0178 82.6665 11.6159 82.9574 10.7059L82.9686 10.678C83.2427 9.82389 82.9351 9.20424 81.1281 8.16031C79.1534 7.02149 78.3926 6.02781 78.8793 4.51496L78.8904 4.48705C79.3492 3.05235 80.9771 2.38245 82.7281 2.9407C84.0875 3.37613 84.8986 4.05161 85.6091 5.1067L84.7476 5.71519C84.1154 4.74384 83.3546 4.16885 82.4036 3.86739C81.1897 3.4822 80.2331 3.88414 79.9645 4.72709L79.9533 4.75501C79.6736 5.62587 79.9757 6.27344 81.8889 7.34527C83.7966 8.46177 84.5126 9.50011 84.0651 10.9069L84.0539 10.9348C83.5504 12.5146 81.9001 13.1231 80.0652 12.537C78.5884 12.068 77.5534 11.2139 76.7646 9.86297Z" fill="white"/>
            <path d="M86.8166 9.64651L86.8278 9.62418C88.0977 7.19581 90.9731 6.14072 93.4905 7.4526C95.0513 8.26206 95.7114 9.29482 96.131 10.5565L95.096 10.9193C94.7156 9.84748 94.1898 8.94871 93.0094 8.34022C91.1074 7.35212 88.8753 8.15041 87.8459 10.1266L87.8348 10.1489C86.7998 12.1363 87.4096 14.4307 89.3116 15.4188C90.492 16.0329 91.499 15.9826 92.7353 15.6253L93.0486 16.5799C91.6892 17.0265 90.3689 17.1047 88.8249 16.3008C86.3467 15.0113 85.5355 12.1084 86.8222 9.64651H86.8166Z" fill="white"/>
            <path d="M96.0568 14.6012L96.0736 14.5788C97.7351 12.491 100.762 11.9104 103.072 13.7415C105.382 15.5725 105.494 18.6094 103.833 20.6972L103.816 20.7196C102.154 22.8074 99.128 23.388 96.8176 21.5569C94.5072 19.7259 94.3953 16.689 96.0568 14.6012ZM102.91 20.0329L102.926 20.0106C104.297 18.2912 104.157 15.8851 102.423 14.5119C100.689 13.1386 98.3504 13.5405 96.9798 15.2599L96.9631 15.2822C95.5925 17.0016 95.7323 19.4077 97.4665 20.781C99.2007 22.1543 101.539 21.7523 102.91 20.0329Z" fill="white"/>
            <path d="M108.481 18.5496L109.275 19.4707L105.214 27.5207L113.796 24.6848L114.568 25.5724L104.459 28.799L103.827 28.0677L108.487 18.5496H108.481Z" fill="white"/>
            <path d="M116.347 28.2306L119.939 34.2318L119.083 34.7398L116.051 29.6765L113.209 31.368L115.922 35.901L115.066 36.409L112.353 31.876L109.444 33.6121L112.51 38.7369L111.654 39.2449L108.023 33.1823L116.342 28.2195L116.347 28.2306Z" fill="white"/>
            <path d="M121.487 37.4308L122.981 41.3107C123.412 42.4327 123.412 43.4376 123.065 44.2247C122.785 44.85 122.27 45.3245 121.549 45.6036L121.521 45.6147C120.022 46.1897 118.735 45.4975 117.941 44.1745L115.311 48.3613L114.83 47.1109L117.342 43.1473L116.352 40.5682L112.833 41.9136L112.441 40.892L121.487 37.4308ZM118.332 42.991C118.847 44.3308 119.921 45.0453 121.084 44.5987L121.112 44.5876C122.237 44.1577 122.567 43.0524 122.008 41.5954L120.939 38.8097L117.269 40.2165L118.332 42.991Z" fill="white"/>
            <path d="M118.823 63.5639L119.578 64.2952C118.582 65.2387 118.079 66.1765 117.989 67.5107C117.9 68.8226 118.538 69.7102 119.489 69.7716H119.517C120.417 69.8331 120.943 69.3864 121.525 67.3879C122.157 65.1996 122.946 64.2282 124.535 64.3343H124.562C126.067 64.4348 127.113 65.8472 126.99 67.6838C126.895 69.1017 126.431 70.0563 125.575 70.9942L124.775 70.302C125.569 69.4534 125.944 68.5826 126.011 67.5889C126.095 66.3217 125.474 65.4899 124.59 65.4285H124.562C123.651 65.3671 123.091 65.8137 122.509 67.9183C121.883 70.034 121.044 70.9775 119.561 70.877H119.533C117.877 70.7653 116.893 69.3139 117.021 67.3991C117.128 65.8527 117.704 64.6469 118.834 63.5583L118.823 63.5639Z" fill="white"/>
            <path d="M121.453 73.2532H121.481C124.144 73.9064 125.867 76.4408 125.201 79.193C124.787 80.9012 123.943 81.7888 122.818 82.4978L122.214 81.5823C123.165 80.957 123.909 80.2313 124.222 78.9418C124.726 76.8595 123.411 74.8945 121.241 74.3697H121.213C119.031 73.8338 116.944 74.9782 116.441 77.0605C116.127 78.35 116.418 79.3158 117.062 80.4267L116.206 80.957C115.445 79.7512 115.053 78.4896 115.462 76.7981C116.122 74.085 118.746 72.6001 121.453 73.2532Z" fill="white"/>
            <path d="M122.986 85.9735L121.291 89.7752C120.799 90.875 120.088 91.5839 119.283 91.891C118.645 92.1366 117.94 92.1087 117.235 91.7961L117.207 91.7849C115.742 91.1317 115.317 89.7361 115.697 88.24L110.869 89.3454L111.417 88.1228L116.005 87.09L117.135 84.5668L113.694 83.0372L114.142 82.0379L122.997 85.9735H122.986ZM116.816 87.6762C116.228 88.9881 116.486 90.2497 117.621 90.7577L117.649 90.7689C118.751 91.2601 119.77 90.7131 120.402 89.284L121.621 86.5597L118.03 84.9631L116.816 87.6762Z" fill="white"/>
            <path d="M114.287 93.1248L114.309 93.1415C116.491 94.6767 117.252 97.6578 115.551 100.064C113.851 102.47 110.824 102.755 108.637 101.219L108.614 101.203C106.433 99.6675 105.672 96.6864 107.373 94.2804C109.073 91.8743 112.1 91.5896 114.287 93.1248ZM109.247 100.265L109.269 100.282C111.07 101.549 113.465 101.27 114.74 99.4665C116.016 97.6578 115.479 95.3522 113.677 94.085L113.655 94.0682C111.853 92.801 109.459 93.0801 108.184 94.8833C106.908 96.692 107.445 98.9976 109.247 100.265Z" fill="white"/>
            <path d="M110.076 106.652L109.298 107.417L103.206 101.243L99.3184 105.061L98.6079 104.341L103.273 99.7577L110.076 106.652Z" fill="white"/>
            <path d="M103.011 113.186L102.127 113.828L97.0363 106.811L92.6169 110.004L92.0239 109.189L97.3272 105.359L103.005 113.197L103.011 113.186Z" fill="white"/>
            <path d="M88.1484 120.821L91.1637 119.56L91.5552 120.492L84.5177 123.439L84.1261 122.507L87.1414 121.245L83.7793 113.257L84.7863 112.833L88.1484 120.821Z" fill="white"/>
            <path d="M81.3242 119.471V119.499C81.9228 122.1 80.4795 124.819 77.6041 125.472C74.7286 126.125 72.284 124.311 71.6966 121.709V121.682C71.098 119.08 72.5413 116.361 75.4167 115.708C78.2922 115.055 80.7368 116.869 81.3242 119.471ZM72.793 121.402V121.43C73.2853 123.574 75.2489 124.97 77.4139 124.478C79.5732 123.987 80.72 121.916 80.2333 119.772V119.744C79.741 117.601 77.7775 116.205 75.6125 116.696C73.4532 117.188 72.3063 119.259 72.793 121.402Z" fill="white"/>
            <path d="M64.2803 127.001L60.9182 126.833C57.8749 126.682 55.8778 124.489 56.0176 121.77V121.742C56.1575 119.023 58.3672 117.019 61.4049 117.17L64.767 117.337L64.2803 126.995V127.001ZM63.2398 125.94L63.6258 118.292L61.3601 118.18C58.9099 118.058 57.2652 119.621 57.1589 121.775V121.803C57.047 123.941 58.5294 125.706 60.9741 125.828L63.2398 125.94Z" fill="white"/>
            <path d="M52.4437 125.923L51.3696 125.727L53.1262 116.215L54.2003 116.41L52.4437 125.923Z" fill="white"/>
            <path d="M50.7829 117.276L49.899 117.846C49.2053 116.662 48.4053 115.959 47.1243 115.563C45.8656 115.177 44.8586 115.59 44.5733 116.5V116.528C44.2992 117.388 44.618 118.002 46.4362 119.024C48.4277 120.14 49.1941 121.128 48.7242 122.647V122.675C48.2711 124.115 46.6543 124.807 44.8978 124.266C43.5328 123.847 42.7104 123.177 41.9888 122.133L42.8447 121.513C43.488 122.479 44.2544 123.043 45.211 123.339C46.4306 123.713 47.3816 123.294 47.6445 122.451V122.423C47.9186 121.553 47.6109 120.905 45.6921 119.855C43.7677 118.761 43.0461 117.729 43.4768 116.316V116.288C43.9747 114.703 45.6138 114.078 47.4543 114.641C48.9368 115.094 49.9829 115.937 50.7829 117.282V117.276Z" fill="white"/>
            <path d="M40.7367 117.61L40.7255 117.632C39.4836 120.072 36.6193 121.16 34.0852 119.882C32.5188 119.089 31.8419 118.068 31.4111 116.806L32.4405 116.426C32.8321 117.493 33.3691 118.386 34.5551 118.983C36.4683 119.949 38.6892 119.123 39.7017 117.141L39.7129 117.119C40.7255 115.12 40.0877 112.831 38.1745 111.866C36.9886 111.268 35.9816 111.33 34.7509 111.698L34.4264 110.743C35.7802 110.28 37.1004 110.191 38.6556 110.978C41.1507 112.24 41.9954 115.131 40.7367 117.61Z" fill="white"/>
            <path d="M31.4406 112.758L31.4238 112.781C29.7847 114.885 26.7638 115.499 24.4366 113.696C22.1095 111.893 21.964 108.856 23.6031 106.752L23.6199 106.729C25.259 104.625 28.2799 104.011 30.6071 105.814C32.9342 107.617 33.0797 110.654 31.4406 112.758ZM24.5317 107.399L24.515 107.421C23.1668 109.158 23.329 111.558 25.08 112.915C26.831 114.271 29.1637 113.841 30.512 112.105L30.5287 112.083C31.8769 110.347 31.7147 107.946 29.9637 106.59C28.2127 105.233 25.8799 105.663 24.5317 107.399Z" fill="white"/>
            <path d="M18.9776 108.948L18.172 108.038L22.1439 99.9431L13.596 102.874L12.8184 101.992L22.8935 98.6535L23.5369 99.3792L18.9832 108.948H18.9776Z" fill="white"/>
            <path d="M11.0009 99.3486L7.34229 93.3866L8.1926 92.8674L11.2806 97.8972L14.1001 96.1722L11.3366 91.6727L12.1869 91.1536L14.9504 95.653L17.8426 93.8834L14.721 88.7922L15.5714 88.273L19.2691 94.2965L11.0065 99.3486H11.0009Z" fill="white"/>
            <path d="M5.75927 90.2004L4.22646 86.3318C3.78451 85.2153 3.77333 84.2105 4.11457 83.4177C4.38869 82.7925 4.89217 82.3068 5.61382 82.0221L5.64179 82.011C7.13544 81.4192 8.4333 82.0947 9.23887 83.4122L11.8234 79.1974L12.3157 80.4423L9.84863 84.4338L10.8668 87.0017L14.3688 85.6172L14.7715 86.6332L5.75927 90.1949V90.2004ZM8.85846 84.6068C8.32701 83.2726 7.24733 82.5692 6.08933 83.027L6.06136 83.0381C4.94251 83.4791 4.62364 84.5901 5.19985 86.0415L6.30191 88.816L9.96052 87.3701L8.86405 84.6068H8.85846Z" fill="white"/>
            <ellipse cx="4.58274" cy="4.58328" rx="4.58274" ry="4.58328" transform="matrix(0.865953 0.500125 -0.499875 0.866098 61.8252 57.5122)" fill="white"/>
          </svg>
        </div>
      </div>
    </div>
  );
};

export default AboutBanner;